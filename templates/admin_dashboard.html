{% extends 'base.html' %}

{% block title %}Admin Dashboard - Maradha Institute{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-md-3">
            <!-- Sidebar -->
            <div class="card shadow-sm rounded-3 mb-4">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i> Dashboard</h5>
                </div>
                <div class="list-group list-group-flush" id="admin-sidebar">
                    <a href="#" class="list-group-item list-group-item-action active" data-target="courses-tab">
                        <i class="fas fa-book me-2"></i> Manage Courses
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-target="enrollments-tab">
                        <i class="fas fa-user-graduate me-2"></i> Student Enrollments
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-target="students-tab">
                        <i class="fas fa-users me-2"></i> Manage Students
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-target="add-course-tab">
                        <i class="fas fa-plus-circle me-2"></i> Add New Course
                    </a>
                    <a href="{{ url_for('admin_add_student') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-user-plus me-2"></i> Add New Student
                    </a>
                    <a href="{{ url_for('add_top_student') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-trophy me-2"></i> Add Top Student
                    </a>
                    <a href="{{ url_for('admin_logout') }}" class="list-group-item list-group-item-action text-danger">
                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                    </a>
                </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="row g-3">
                <div class="col-12">
                    <div class="card bg-primary text-white shadow-sm rounded-3">
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">Total Courses</h6>
                                    <h3 class="mb-0">{{ courses|length }}</h3>
                                </div>
                                <div class="rounded-circle bg-white p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                    <i class="fas fa-book text-primary" style="font-size: 1.5rem;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card bg-success text-white shadow-sm rounded-3">
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">Total Enrollments</h6>
                                    <h3 class="mb-0">{{ enrollments|length }}</h3>
                                </div>
                                <div class="rounded-circle bg-white p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                    <i class="fas fa-user-graduate text-success" style="font-size: 1.5rem;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card bg-info text-white shadow-sm rounded-3">
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">Registered Students</h6>
                                    <h3 class="mb-0">{{ students|length }}</h3>
                                </div>
                                <div class="rounded-circle bg-white p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                    <i class="fas fa-users text-info" style="font-size: 1.5rem;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-9">
            <!-- Content Tabs -->
            <div class="tab-content">
                <!-- Courses Management Tab -->
                <div class="tab-pane fade show active" id="courses-tab">
                    <div class="card shadow-sm rounded-3">
                        <div class="card-header bg-light py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">All Courses</h5>
                                <a href="{{ url_for('add_course') }}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-plus me-1"></i> Add New Course
                                </a>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Course</th>
                                            <th>Duration</th>
                                            <th>Price</th>
                                            <th>Enrollments</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% if courses %}
                                            {% for course in courses %}
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="course-img-sm me-3 bg-light rounded d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                            <i class="fas fa-laptop-code text-primary"></i>
                                                        </div>
                                                        <div>
                                                            <h6 class="mb-0">{{ course.title }}</h6>
                                                            <small class="text-muted">Added on {{ course.created_at.strftime('%d %b, %Y') }}</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div>
                                                        <span class="badge bg-light text-dark">
                                                            {{ course.start_date.strftime('%d %b, %Y') }}
                                                        </span>
                                                        <i class="fas fa-arrow-right mx-1 text-muted small"></i>
                                                        <span class="badge bg-light text-dark">
                                                            {{ course.end_date.strftime('%d %b, %Y') }}
                                                        </span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div>
                                                        <span class="text-decoration-line-through text-muted small">₹{{ course.price }}</span>
                                                        <span class="fw-bold">₹{{ course.offer_price }}</span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span class="badge bg-info text-dark">
                                                        {{ course.enrollments|length }} students
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="btn-group" role="group" aria-label="Course actions">
                                                        <a href="{{ url_for('edit_course', course_id=course.id) }}" class="btn btn-sm btn-outline-primary">
                                                            <i class="fas fa-edit"></i>
                                                        </a>
                                                        <a href="#" class="btn btn-sm btn-outline-info view-enrollments" data-course-id="{{ course.id }}">
                                                            <i class="fas fa-users"></i>
                                                        </a>
                                                        <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteCourseModal{{ course.id }}">
                                                            <i class="fas fa-trash-alt"></i>
                                                        </button>
                                                    </div>
                                                    
                                                    <!-- Delete Course Modal -->
                                                    <div class="modal fade" id="deleteCourseModal{{ course.id }}" tabindex="-1" aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header bg-danger text-white">
                                                                    <h5 class="modal-title">Confirm Deletion</h5>
                                                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <p>Are you sure you want to delete <strong>{{ course.title }}</strong>?</p>
                                                                    <p class="text-danger mb-0">
                                                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                                                        This action will also delete all enrollments for this course and cannot be undone!
                                                                    </p>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                    <form action="{{ url_for('delete_course', course_id=course.id) }}" method="post">
                                                                        <button type="submit" class="btn btn-danger">Delete Course</button>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="5" class="text-center py-4">
                                                    <div class="empty-state">
                                                        <i class="fas fa-book empty-icon mb-3"></i>
                                                        <h5>No courses available</h5>
                                                        <p class="text-muted">Add your first course by clicking the "Add New Course" button.</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Enrollments Tab -->
                <div class="tab-pane fade" id="enrollments-tab">
                    <div class="card shadow-sm rounded-3">
                        <div class="card-header bg-light py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Student Enrollments</h5>
                                <div class="d-flex align-items-center">
                                    <select class="form-select form-select-sm me-2" id="courseFilter">
                                        <option value="0">All Courses</option>
                                        {% for course in courses %}
                                        <option value="{{ course.id }}">{{ course.title }}</option>
                                        {% endfor %}
                                    </select>
                                    <input type="text" class="form-control form-control-sm" placeholder="Search..." id="enrollmentSearch">
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0" id="enrollmentsTable">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Student</th>
                                            <th>Course</th>
                                            <th>Contact</th>
                                            <th>Location</th>
                                            <th>Applied On</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% if enrollments %}
                                            {% for enrollment in enrollments %}
                                            <tr data-course-id="{{ enrollment.course_id }}">
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="student-img-sm me-3 bg-light rounded d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                            <i class="fas fa-user text-primary"></i>
                                                        </div>
                                                        <div>
                                                            <h6 class="mb-0">{{ enrollment.full_name }}</h6>
                                                            <small class="text-muted">{{ enrollment.education_status }}</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>{{ enrollment.course.title }}</td>
                                                <td>
                                                    <div>
                                                        <div><i class="fas fa-phone-alt text-primary me-1 small"></i> {{ enrollment.phone_number }}</div>
                                                        <div><i class="fab fa-whatsapp text-success me-1 small"></i> {{ enrollment.whatsapp_number }}</div>
                                                    </div>
                                                </td>
                                                <td>{{ enrollment.village_town }}, {{ enrollment.district }}</td>
                                                <td>{{ enrollment.created_at.strftime('%d %b, %Y') }}</td>
                                                <td>
                                                    <button type="button" class="btn btn-sm btn-outline-primary view-enrollment" 
                                                            data-bs-toggle="modal" data-bs-target="#viewEnrollmentModal{{ enrollment.id }}">
                                                        <i class="fas fa-eye"></i> View
                                                    </button>
                                                    
                                                    <!-- View Enrollment Modal -->
                                                    <div class="modal fade" id="viewEnrollmentModal{{ enrollment.id }}" tabindex="-1" aria-hidden="true">
                                                        <div class="modal-dialog modal-lg">
                                                            <div class="modal-content">
                                                                <div class="modal-header bg-primary text-white">
                                                                    <h5 class="modal-title">Student Application Details</h5>
                                                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <div class="row mb-4">
                                                                        <div class="col-md-6">
                                                                            <h6 class="fw-bold">Personal Information</h6>
                                                                            <table class="table table-borderless table-sm">
                                                                                <tr>
                                                                                    <td class="text-muted">Full Name:</td>
                                                                                    <td>{{ enrollment.full_name }}</td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td class="text-muted">Father's Name:</td>
                                                                                    <td>{{ enrollment.father_name }}</td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td class="text-muted">Mother's Name:</td>
                                                                                    <td>{{ enrollment.mother_name }}</td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td class="text-muted">Education:</td>
                                                                                    <td>{{ enrollment.education_status }}</td>
                                                                                </tr>
                                                                            </table>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <h6 class="fw-bold">Contact Information</h6>
                                                                            <table class="table table-borderless table-sm">
                                                                                <tr>
                                                                                    <td class="text-muted">Phone:</td>
                                                                                    <td>{{ enrollment.phone_number }}</td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td class="text-muted">WhatsApp:</td>
                                                                                    <td>{{ enrollment.whatsapp_number }}</td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td class="text-muted">Email:</td>
                                                                                    <td>{{ enrollment.email or 'Not provided' }}</td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td class="text-muted">Applied On:</td>
                                                                                    <td>{{ enrollment.created_at.strftime('%d %B, %Y') }}</td>
                                                                                </tr>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="row mb-4">
                                                                        <div class="col-12">
                                                                            <h6 class="fw-bold">Address</h6>
                                                                            <p>{{ enrollment.address }}</p>
                                                                            <div class="row">
                                                                                <div class="col-md-3">
                                                                                    <p class="mb-0 text-muted">Village/Town:</p>
                                                                                    <p class="fw-medium">{{ enrollment.village_town }}</p>
                                                                                </div>
                                                                                <div class="col-md-3">
                                                                                    <p class="mb-0 text-muted">District:</p>
                                                                                    <p class="fw-medium">{{ enrollment.district }}</p>
                                                                                </div>
                                                                                <div class="col-md-3">
                                                                                    <p class="mb-0 text-muted">State:</p>
                                                                                    <p class="fw-medium">{{ enrollment.state }}</p>
                                                                                </div>
                                                                                <div class="col-md-3">
                                                                                    <p class="mb-0 text-muted">Pin Code:</p>
                                                                                    <p class="fw-medium">{{ enrollment.pin_code }}</p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="row mb-4">
                                                                        <div class="col-12">
                                                                            <h6 class="fw-bold">Course Information</h6>
                                                                            <table class="table table-borderless table-sm">
                                                                                <tr>
                                                                                    <td class="text-muted">Applied For:</td>
                                                                                    <td>{{ enrollment.course.title }}</td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td class="text-muted">Course Duration:</td>
                                                                                    <td>{{ enrollment.course.start_date.strftime('%d %b, %Y') }} to {{ enrollment.course.end_date.strftime('%d %b, %Y') }}</td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td class="text-muted">Course Fee:</td>
                                                                                    <td>₹{{ enrollment.course.offer_price }} <small class="text-muted text-decoration-line-through">₹{{ enrollment.course.price }}</small></td>
                                                                                </tr>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="row">
                                                                        <div class="col-12">
                                                                            <h6 class="fw-bold">Motivation</h6>
                                                                            <p class="mb-0">{{ enrollment.why_learn }}</p>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    {% if enrollment.id_photo_path %}
                                                                    <div class="row mt-4">
                                                                        <div class="col-12">
                                                                            <h6 class="fw-bold">Uploaded Document</h6>
                                                                            <a href="{{ url_for('static', filename=enrollment.id_photo_path) }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                                                                <i class="fas fa-file-alt me-1"></i> View Document
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                    {% endif %}
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                    <a href="tel:{{ enrollment.phone_number }}" class="btn btn-success">
                                                                        <i class="fas fa-phone me-1"></i> Call Student
                                                                    </a>
                                                                    <a href="https://wa.me/{{ enrollment.whatsapp_number }}" class="btn btn-primary" target="_blank">
                                                                        <i class="fab fa-whatsapp me-1"></i> WhatsApp
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="6" class="text-center py-4">
                                                    <div class="empty-state">
                                                        <i class="fas fa-user-graduate empty-icon mb-3"></i>
                                                        <h5>No student enrollments yet</h5>
                                                        <p class="text-muted">Students will appear here when they enroll in your courses.</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Add Course Tab -->
                <div class="tab-pane fade {% if action == 'add_course' %}show active{% endif %}" id="add-course-tab">
                    <div class="card shadow-sm rounded-3">
                        <div class="card-header bg-light py-3">
                            <h5 class="mb-0">
                                {% if action == 'edit_course' %}
                                    <i class="fas fa-edit me-2"></i> Edit Course
                                {% else %}
                                    <i class="fas fa-plus-circle me-2"></i> Add New Course
                                {% endif %}
                            </h5>
                        </div>
                        <div class="card-body p-4">
                            <form method="post" 
                                  {% if action == 'edit_course' %}
                                  action="{{ url_for('edit_course', course_id=course.id) }}"
                                  {% else %}
                                  action="{{ url_for('add_course') }}"
                                  {% endif %}
                                  novalidate>
                                {% if form %}
                                {{ form.hidden_tag() }}
                                
                                <div class="row g-3">
                                    <div class="col-md-12">
                                        <label for="{{ form.title.id }}" class="form-label">Course Title <span class="text-danger">*</span></label>
                                        {{ form.title(class="form-control" + (" is-invalid" if form.title.errors else ""), placeholder="Enter course title") }}
                                        {% if form.title.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.title.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-md-12">
                                        <label for="{{ form.description.id }}" class="form-label">Course Description <span class="text-danger">*</span></label>
                                        {{ form.description(class="form-control" + (" is-invalid" if form.description.errors else ""), placeholder="Enter detailed course description", rows=4) }}
                                        {% if form.description.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.description.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="{{ form.start_date.id }}" class="form-label">Start Date <span class="text-danger">*</span></label>
                                        {{ form.start_date(class="form-control" + (" is-invalid" if form.start_date.errors else ""), type="date") }}
                                        {% if form.start_date.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.start_date.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="{{ form.end_date.id }}" class="form-label">End Date <span class="text-danger">*</span></label>
                                        {{ form.end_date(class="form-control" + (" is-invalid" if form.end_date.errors else ""), type="date") }}
                                        {% if form.end_date.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.end_date.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="{{ form.price.id }}" class="form-label">Regular Price (₹) <span class="text-danger">*</span></label>
                                        {{ form.price(class="form-control" + (" is-invalid" if form.price.errors else ""), placeholder="Enter regular price", type="number") }}
                                        {% if form.price.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.price.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="{{ form.offer_price.id }}" class="form-label">Offer Price (₹) <span class="text-danger">*</span></label>
                                        {{ form.offer_price(class="form-control" + (" is-invalid" if form.offer_price.errors else ""), placeholder="Enter offer price", type="number") }}
                                        {% if form.offer_price.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.offer_price.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-md-12">
                                        <label for="{{ form.image_url.id }}" class="form-label">Image URL</label>
                                        {{ form.image_url(class="form-control" + (" is-invalid" if form.image_url.errors else ""), placeholder="Enter image URL (optional)") }}
                                        {% if form.image_url.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.image_url.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                        <div class="form-text">Enter a URL for the course banner image (e.g., from Unsplash or other free image sites)</div>
                                    </div>
                                    
                                    <div class="col-md-12">
                                        <label for="{{ form.benefits.id }}" class="form-label">Course Benefits</label>
                                        {{ form.benefits(class="form-control" + (" is-invalid" if form.benefits.errors else ""), placeholder="Enter course benefits (one per line)", rows=4) }}
                                        {% if form.benefits.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.benefits.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                        <div class="form-text">Enter each benefit on a new line (e.g., "Learn HTML & CSS" "Build real projects" etc.)</div>
                                    </div>
                                    
                                    <div class="col-12 mt-4">
                                        {{ form.submit(class="btn btn-primary") }}
                                        {% if action == 'edit_course' %}
                                            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">Cancel</a>
                                        {% endif %}
                                    </div>
                                </div>
                                {% else %}
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i> Please use the "Add New Course" button to add a course.
                                </div>
                                {% endif %}
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- View Enrollment Tab (shown when triggered) -->
                {% if action == 'view_enrollment' %}
                <div class="tab-pane fade show active" id="view-enrollment-tab">
                    <div class="card shadow-sm rounded-3">
                        <div class="card-header bg-light py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-user-graduate me-2"></i> Student Application Details</h5>
                                <a href="{{ url_for('admin_dashboard') }}" class="btn btn-sm btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
                                </a>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <!-- Student details are rendered here same as in the modal -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <h6 class="fw-bold">Personal Information</h6>
                                    <table class="table table-borderless">
                                        <tr>
                                            <td width="150" class="text-muted">Full Name:</td>
                                            <td>{{ enrollment.full_name }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-muted">Father's Name:</td>
                                            <td>{{ enrollment.father_name }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-muted">Mother's Name:</td>
                                            <td>{{ enrollment.mother_name }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-muted">Education:</td>
                                            <td>{{ enrollment.education_status }}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="fw-bold">Contact Information</h6>
                                    <table class="table table-borderless">
                                        <tr>
                                            <td width="150" class="text-muted">Phone:</td>
                                            <td>{{ enrollment.phone_number }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-muted">WhatsApp:</td>
                                            <td>{{ enrollment.whatsapp_number }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-muted">Email:</td>
                                            <td>{{ enrollment.email or 'Not provided' }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-muted">Applied On:</td>
                                            <td>{{ enrollment.created_at.strftime('%d %B, %Y') }}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h6 class="fw-bold">Address</h6>
                                    <p>{{ enrollment.address }}</p>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <p class="mb-0 text-muted">Village/Town:</p>
                                            <p class="fw-medium">{{ enrollment.village_town }}</p>
                                        </div>
                                        <div class="col-md-3">
                                            <p class="mb-0 text-muted">District:</p>
                                            <p class="fw-medium">{{ enrollment.district }}</p>
                                        </div>
                                        <div class="col-md-3">
                                            <p class="mb-0 text-muted">State:</p>
                                            <p class="fw-medium">{{ enrollment.state }}</p>
                                        </div>
                                        <div class="col-md-3">
                                            <p class="mb-0 text-muted">Pin Code:</p>
                                            <p class="fw-medium">{{ enrollment.pin_code }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h6 class="fw-bold">Course Information</h6>
                                    <table class="table table-borderless">
                                        <tr>
                                            <td width="150" class="text-muted">Applied For:</td>
                                            <td>{{ enrollment.course.title }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-muted">Course Duration:</td>
                                            <td>{{ enrollment.course.start_date.strftime('%d %b, %Y') }} to {{ enrollment.course.end_date.strftime('%d %b, %Y') }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-muted">Course Fee:</td>
                                            <td>₹{{ enrollment.course.offer_price }} <small class="text-muted text-decoration-line-through">₹{{ enrollment.course.price }}</small></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-12">
                                    <h6 class="fw-bold">Motivation</h6>
                                    <p>{{ enrollment.why_learn }}</p>
                                </div>
                            </div>
                            
                            {% if enrollment.id_photo_path %}
                            <div class="row mt-4">
                                <div class="col-12">
                                    <h6 class="fw-bold">Uploaded Document</h6>
                                    <a href="{{ url_for('static', filename=enrollment.id_photo_path) }}" class="btn btn-outline-primary" target="_blank">
                                        <i class="fas fa-file-alt me-2"></i> View Document
                                    </a>
                                </div>
                            </div>
                            {% endif %}
                            
                            <div class="row mt-4">
                                <div class="col-12">
                                    <h6 class="fw-bold">Actions</h6>
                                    <a href="tel:{{ enrollment.phone_number }}" class="btn btn-success me-2">
                                        <i class="fas fa-phone me-1"></i> Call Student
                                    </a>
                                    <a href="https://wa.me/{{ enrollment.whatsapp_number }}" class="btn btn-primary me-2" target="_blank">
                                        <i class="fab fa-whatsapp me-1"></i> WhatsApp
                                    </a>
                                    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Students Management Tab -->
                <div class="tab-pane fade" id="students-tab">
                    <div class="card shadow-sm rounded-3">
                        <div class="card-header bg-light py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Registered Students</h5>
                                <a href="{{ url_for('admin_add_student') }}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-user-plus me-1"></i> Add New Student
                                </a>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Student</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Registered</th>
                                            <th>Courses</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% if students %}
                                            {% for student in students %}
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="student-avatar me-3 bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                            <i class="fas fa-user text-primary"></i>
                                                        </div>
                                                        <div>
                                                            <h6 class="mb-0">{{ student.full_name }}</h6>
                                                            <small class="text-muted">@{{ student.username }}</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>{{ student.email }}</td>
                                                <td>{{ student.phone_number }}</td>
                                                <td>{{ student.created_at.strftime('%d %b, %Y') }}</td>
                                                <td>
                                                    <span class="badge bg-info text-dark">
                                                        {{ student.enrollments|length }} courses
                                                    </span>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="5" class="text-center py-4">
                                                    <div class="empty-state">
                                                        <i class="fas fa-users empty-icon mb-3"></i>
                                                        <h5>No students registered yet</h5>
                                                        <p class="text-muted">Add your first student by clicking the "Add New Student" button.</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
{% endblock %}
